[rank0]:[W1114 17:13:42.707528959 ProcessGroupNCCL.cpp:4561] [PG ID 0 PG GUID 0 Rank 0]  using GPU 0 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect. Specify device_ids in barrier() to force use of a particular device, or call init_process_group() with a device_id.
wandb: Currently logged in as: alufr (alufr-ben-gurion-university-of-the-negev) to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.21.0
wandb: Run data is saved locally in /sise/eliyanac-group/ron_al/ttt_training_run2/wandb/run-20251114_171343-n387dnun
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run run2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/alufr-ben-gurion-university-of-the-negev/moshi_in_place
wandb: üöÄ View run at https://wandb.ai/alufr-ben-gurion-university-of-the-negev/moshi_in_place/runs/n387dnun
wandb: WARNING Calling wandb.login() after wandb.init() has no effect.
/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi/moshi/moshi/models/loaders.py:204: UserWarning: Repository kyutai/moshiko-pytorch-bf16 contains no config.json. Assuming this is a Moshi 7B. Support for such repository might be removed in the future.
  warnings.warn(
2025-11-14 17:13:47 (IST) - 0:00:09 - finetune.wrapped_model - WARNING - Buffer transformer.layers.10.gating.ttt_clip_event_counter still meta - initializing as zeros
2025-11-14 17:13:48 (IST) - 0:00:10 - finetune.wrapped_model - WARNING - Buffer transformer.layers.20.gating.ttt_clip_event_counter still meta - initializing as zeros
2025-11-14 17:13:49 (IST) - 0:00:11 - finetune.wrapped_model - WARNING - Buffer transformer.layers.30.gating.ttt_clip_event_counter still meta - initializing as zeros
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2224, in _finish
    logger.info(f"finishing run {self._get_path()}")
Message: 'finishing run alufr-ben-gurion-university-of-the-negev/moshi_in_place/n387dnun'
Arguments: ()
--- Logging error ---
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1021, in handleError
    sys.stderr.write('--- Logging error ---\n')
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Traceback (most recent call last):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)

During handling of the above exception, another exception occurred:

--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Traceback (most recent call last):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
OSError: [Errno 116] Stale file handle
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Call stack:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1023, in handleError
    sys.stderr.write('Call stack:\n')
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Message: 'got exitcode: 0'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2423, in _atexit_cleanup
    logger.info(f"got exitcode: {exit_code}")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1038, in handleError
    sys.stderr.write('Message: %r\n'
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1021, in handleError
    sys.stderr.write('--- Logging error ---\n')
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Traceback (most recent call last):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)

During handling of the above exception, another exception occurred:

--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Traceback (most recent call last):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
OSError: [Errno 116] Stale file handle
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1022, in handleError
    traceback.print_exception(t, v, tb, None, sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 121, in print_exception
    print(line, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Call stack:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1023, in handleError
    sys.stderr.write('Call stack:\n')
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1031, in handleError
    traceback.print_stack(frame, file=sys.stderr)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 206, in print_stack
    print_list(extract_stack(f, limit=limit), file=file)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/traceback.py", line 25, in print_list
    print(item, file=file, end="")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
Message: 'restore'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 662, in _on_write
    cb(written_data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2385, in <lambda>
    lambda data: self._console_raw_callback("stderr", data),
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 464, in wrapper_fn
    raise UsageError(message)
wandb.errors.errors.UsageError: Run (n387dnun) is finished. The call to `_console_raw_callback` will be ignored. Please make sure that you are using an active run.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2405, in _restore
    logger.info("restore")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1477, in info
    self._log(INFO, msg, args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1624, in _log
    self.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1634, in handle
    self.callHandlers(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1696, in callHandlers
    hdlr.handle(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 968, in handle
    self.emit(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1218, in emit
    StreamHandler.emit(self, record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1108, in emit
    self.handleError(record)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1038, in handleError
    sys.stderr.write('Message: %r\n'
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 79, in inner
    return func(*args, **kwds)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/console_capture.py", line 179, in write_with_callbacks
    cb(s, n)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/lib/redirect.py", line 664, in _on_write
    logger.exception("error in %s callback", self.src)
Message: 'error in %s callback'
Arguments: ('stderr',)
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2435, in _atexit_cleanup
    self._on_finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2673, in _on_finish
    self._console_stop()  # TODO: there's a race here with jupyter console logging
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2464, in _console_stop
    self._restore()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2411, in _restore
    logger.info("restore done")
Message: 'restore done'
Arguments: ()
wandb:                                                                                
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2448, in _atexit_cleanup
    Run._footer(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3815, in _footer
    Run._footer_history_summary_info(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3903, in _footer_history_summary_info
    logger.info("rendering history")
Message: 'rendering history'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2448, in _atexit_cleanup
    Run._footer(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3815, in _footer
    Run._footer_history_summary_info(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3935, in _footer_history_summary_info
    logger.info("rendering summary")
Message: 'rendering summary'
Arguments: ()
wandb: 
wandb: Run history:
wandb:           train/allocated_mem ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:                 train/avg_wps ‚ñÅ‚ñÇ‚ñÉ‚ñÑ‚ñÑ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñá‚ñá‚ñá‚ñá‚ñá‚ñá‚ñá‚ñá‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:          train/eta_in_seconds ‚ñà‚ñÑ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:                    train/loss ‚ñÖ‚ñÜ‚ñà‚ñÑ‚ñÉ‚ñÇ‚ñà‚ñá‚ñÉ‚ñÑ‚ñÖ‚ñÖ‚ñÅ‚ñÜ‚ñÉ‚ñÇ‚ñÅ‚ñÇ‚ñÅ‚ñÅ‚ñÇ‚ñÅ‚ñÑ‚ñÅ‚ñÇ‚ñÜ‚ñá‚ñá‚ñÜ‚ñà‚ñÖ‚ñá‚ñá‚ñà‚ñá‚ñÖ‚ñÖ‚ñÜ‚ñÉ‚ñá
wandb:                      train/lr ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñá‚ñá‚ñá‚ñà‚ñà
wandb:      train/peak_allocated_mem ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:            train/percent_done ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñá‚ñá‚ñá‚ñá‚ñà‚ñà‚ñà
wandb:        train/prob_real_tokens ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:          train/ttt/delta_norm ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñá‚ñá‚ñá‚ñÜ‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:           train/ttt/grad_norm ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÅ‚ñÉ‚ñà‚ñÉ‚ñà‚ñÅ‚ñà‚ñà‚ñÖ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:         train/ttt/param_count ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
wandb:          train/ttt/param_norm ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÖ‚ñÖ‚ñÜ‚ñá‚ñà
wandb: train/ttt/relative_change_pct ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñá‚ñá‚ñà‚ñà‚ñà‚ñà‚ñà
wandb:                     train/wps ‚ñà‚ñÅ‚ñá‚ñÜ‚ñÜ‚ñÖ‚ñÖ‚ñÖ‚ñÑ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ
wandb: 
wandb: Run summary:
wandb:           train/allocated_mem 20.95441
wandb:                 train/avg_wps 5258.35946
wandb:          train/eta_in_seconds 12374.58194
wandb:                    train/loss 4.72413
wandb:                      train/lr 8e-05
wandb:      train/peak_allocated_mem 39.27134
wandb:            train/percent_done 3.6
wandb:        train/prob_real_tokens 0.99959
wandb:          train/ttt/delta_norm 0.24297
wandb:           train/ttt/grad_norm 1.0
wandb:         train/ttt/param_count 9
wandb:          train/ttt/param_norm 126.02345
wandb: train/ttt/relative_change_pct 0.1928
wandb:                     train/wps 5320.71617
wandb: 
--- Logging error ---
Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1104, in emit
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle
Call stack:
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2240, in _finish
    self._atexit_cleanup(exit_code=exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2448, in _atexit_cleanup
    Run._footer(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3822, in _footer
    Run._footer_sync_info(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 3864, in _footer_sync_info
    logger.info("logging synced files")
Message: 'logging synced files'
Arguments: ()
wandb: üöÄ View run run2 at: https://wandb.ai/alufr-ben-gurion-university-of-the-negev/moshi_in_place/runs/n387dnun
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/alufr-ben-gurion-university-of-the-negev/moshi_in_place
wandb: Synced 2 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: /sise/eliyanac-group/ron_al/ttt_training_run2/wandb/run-20251114_171343-n387dnun/logs
2025-11-14 17:21:41 (IST) - 0:08:04 - utils - ERROR - Error while closing eval_logger!
2025-11-14 17:21:41 (IST) - 0:08:04 - utils - ERROR - Error while closing metrics_logger!
Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1180, in close
    self.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
    self.stream.flush()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
    wandb.finish()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
    wandb.run.finish(exit_code=exit_code, quiet=quiet)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
    return self._finish(exit_code)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
    return func(self, *args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2246, in _finish
    hook.call()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 692, in dispose_handler
    handler.close()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1185, in close
    stream.close()
OSError: [Errno 116] Stale file handle

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
    fire.Fire(train)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
    with ExitStack() as exit_stack:
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 576, in __exit__
    raise exc_details[1]
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
    if cb(*exc_details):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
    thing.close()
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 202, in close
    self.summary_writer.close()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 1200, in close
    writer.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 153, in flush
    self.event_writer.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 125, in flush
    self._async_writer.flush()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 186, in flush
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
    yield
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
    _train(args, exit_stack)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
    metrics_logger.log(train_logs, step=state.step)
  File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
    self.summary_writer.add_scalar(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
    self._get_file_writer().add_summary(summary, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
    self.add_event(event, global_step, walltime)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
    self.event_writer.add_event(event)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
    self._async_writer.write(event.SerializeToString())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
    self._check_worker_status()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1180, in close
[rank0]:     self.flush()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1084, in flush
[rank0]:     self.stream.flush()
[rank0]: OSError: [Errno 116] Stale file handle

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: OSError: [Errno 116] Stale file handle

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
[rank0]:     yield
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
[rank0]:     if cb(*exc_details):
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
[rank0]:     self.gen.throw(typ, value, traceback)
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
[rank0]:     thing.close()
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 209, in close
[rank0]:     wandb.finish()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 4060, in finish
[rank0]:     wandb.run.finish(exit_code=exit_code, quiet=quiet)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
[rank0]:     return func(self, *args, **kwargs)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 443, in wrapper
[rank0]:     return func(self, *args, **kwargs)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2212, in finish
[rank0]:     return self._finish(exit_code)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 398, in wrapper
[rank0]:     return func(self, *args, **kwargs)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 2246, in _finish
[rank0]:     hook.call()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 692, in dispose_handler
[rank0]:     handler.close()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/logging/__init__.py", line 1185, in close
[rank0]:     stream.close()
[rank0]: OSError: [Errno 116] Stale file handle

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 539, in <module>
[rank0]:     fire.Fire(train)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 135, in Fire
[rank0]:     component_trace = _Fire(component, args, parsed_flag_args, context, name)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 468, in _Fire
[rank0]:     component, remaining_args = _CallAndUpdateTrace(
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/fire/core.py", line 684, in _CallAndUpdateTrace
[rank0]:     component = fn(*varargs, **kwargs)
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 123, in train
[rank0]:     with ExitStack() as exit_stack:
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 576, in __exit__
[rank0]:     raise exc_details[1]
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 561, in __exit__
[rank0]:     if cb(*exc_details):
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/contextlib.py", line 153, in __exit__
[rank0]:     self.gen.throw(typ, value, traceback)
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 76, in logged_closing
[rank0]:     thing.close()
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 202, in close
[rank0]:     self.summary_writer.close()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 1200, in close
[rank0]:     writer.flush()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 153, in flush
[rank0]:     self.event_writer.flush()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 125, in flush
[rank0]:     self._async_writer.flush()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 186, in flush
[rank0]:     self._check_worker_status()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
[rank0]:     raise exception
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/utils.py", line 72, in logged_closing
[rank0]:     yield
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 124, in train
[rank0]:     _train(args, exit_stack)
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/train.py", line 524, in _train
[rank0]:     metrics_logger.log(train_logs, step=state.step)
[rank0]:   File "/home/alufr/moshi_in_place_ttt/moshi_in_place/moshi-finetune/finetune/monitoring/metrics_logger.py", line 173, in log
[rank0]:     self.summary_writer.add_scalar(
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 381, in add_scalar
[rank0]:     self._get_file_writer().add_summary(summary, global_step, walltime)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 115, in add_summary
[rank0]:     self.add_event(event, global_step, walltime)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 99, in add_event
[rank0]:     self.event_writer.add_event(event)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 117, in add_event
[rank0]:     self._async_writer.write(event.SerializeToString())
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 171, in write
[rank0]:     self._check_worker_status()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
[rank0]:     raise exception
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
[rank0]:     self.run()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
[rank0]:     self._run()
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
[rank0]:     self._record_writer.write(data)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
[rank0]:     self._writer.write(header + header_crc + data + footer_crc)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
[rank0]:     self.fs.append(self.filename, file_content, self.binary_mode)
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
[rank0]:     self._write(filename, file_content, "ab" if binary_mode else "a")
[rank0]:   File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
[rank0]:     with io.open(filename, mode, encoding=encoding) as f:
[rank0]: FileNotFoundError: [Errno 2] No such file or directory: b'/sise/eliyanac-group/ron_al/ttt_training_run2/tb/events.out.tfevents.1763133222.ise-6000-01.auth.ad.bgu.ac.il.1681989.0.train'
[rank0]:[W1114 17:21:42.095101062 ProcessGroupNCCL.cpp:1496] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
E1114 17:21:44.106000 1681980 site-packages/torch/distributed/elastic/multiprocessing/api.py:869] failed (exitcode: 1) local_rank: 0 (pid: 1681989) of binary: /home/alufr/.conda/envs/moshi_ttt_fixed/bin/python3.10
Traceback (most recent call last):
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/bin/torchrun", line 7, in <module>
    sys.exit(main())
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/distributed/run.py", line 918, in main
    run(args)
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/distributed/run.py", line 909, in run
    elastic_launch(
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 138, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/alufr/.conda/envs/moshi_ttt_fixed/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 269, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
train.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-11-14_17:21:44
  host      : ise-6000-01.auth.ad.bgu.ac.il
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1681989)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
